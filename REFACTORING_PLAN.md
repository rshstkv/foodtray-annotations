# –ü–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∏—Å—Ç–µ–º—ã –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π

## –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞

–°–∏—Å—Ç–µ–º–∞ –¥–ª—è –∞–Ω–Ω–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∑–∞–∫–∞–∑–æ–≤ –µ–¥—ã. –ï—Å—Ç—å –¥–≤–∞ —Ç–∏–ø–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞:
- **Main (45¬∞)** - –æ—Å–Ω–æ–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- **Qualifying (90¬∞)** - –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

–ó–∞–¥–∞—á–∞ –∞–Ω–Ω–æ—Ç–∞—Ç–æ—Ä–æ–≤ - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Ä–∞–∑–º–µ—Ç–∫—É (QWEN), —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ:
- –í—Å–µ –±–ª—é–¥–∞ –∏–∑ —á–µ–∫–∞ —Ä–∞–∑–º–µ—á–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ bounding boxes
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ bbox –Ω–∞ –æ–±–µ–∏—Ö –∫–∞—Ä—Ç–∏–Ω–∫–∞—Ö —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —á–µ–∫–æ–º
- –¢–∞—Ä–µ–ª–∫–∏ —Ä–∞–∑–º–µ—á–µ–Ω—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã —Ä–∞–∑–º–µ—á–µ–Ω—ã (–±–∞–∑–∑–µ—Ä—ã, non-food items)

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–∫–æ–º–º–∏—Ç aabca52)

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- ‚úÖ –ë–∞–∑–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `/annotations/[id]` - –ø–æ–ª–Ω–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞ –æ–¥–Ω–æ–≥–æ recognition
- ‚úÖ Quick mode –≤ `/annotations/tasks/dish_validation?mode=quick`
- ‚úÖ Edit mode –≤ `/annotations/tasks/dish_validation?mode=edit`
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç validation_mode (quick/edit) –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±–ª—é–¥
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π
- ‚úÖ Hotkeys –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- ‚úÖ DishList –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–ª—é–¥ –∏–∑ —á–µ–∫–∞

### –ü—Ä–æ–±–ª–µ–º—ã:
1. **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å `/annotations/[id]` —É—Å—Ç–∞—Ä–µ–≤—à–∏–π**:
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç reducer –∏ undo/redo (–Ω–µ –Ω—É–∂–Ω–æ)
   - –¢–∞–±—ã –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ (–Ω–µ—É–¥–æ–±–Ω–æ)
   - –ù–µ—Ç —Ç–∞—Ä–µ–ª–æ–∫ –≤ –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏
   - –û—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç edit mode –≤ dish_validation

2. **–¢–∞—Ä–µ–ª–∫–∏ –Ω–µ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤ validation_mode**:
   - Quick mode –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ –±–ª—é–¥–∞–º
   - Plates –¥–æ–ª–∂–Ω—ã —Ç–æ–∂–µ —É—á–∏—Ç—ã–≤–∞—Ç—å—Å—è: quick —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ò –±–ª—é–¥–∞ –ò plates —Å–æ–≤–ø–∞–¥–∞—é—Ç

3. **–ù—É–º–µ—Ä–∞—Ü–∏—è —Å–±–∏–≤–∞–µ—Ç**:
   - –ï—Å–ª–∏ –µ—Å—Ç—å —Ç–∞—Ä–µ–ª–∫–∏ (#1), —Ç–æ –ø–µ—Ä–≤–æ–µ –±–ª—é–¥–æ #2, –Ω–æ —ç—Ç–æ —Å–±–∏–≤–∞–µ—Ç —Å —Ç–æ–ª–∫—É
   - –ù—É–∂–Ω–∞ –±–æ–ª–µ–µ –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

4. **–ù–µ—Ç —Ç—É–ª–±–æ–∫—Å–æ–≤ –Ω–∞–¥ bbox**:
   - –í edit mode –Ω–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤ –Ω–∞–¥ –∫–∞–∂–¥—ã–º bbox (resize, overlapped, error, delete)
   - –î–ª—è —Ç–∞—Ä–µ–ª–æ–∫ –Ω–µ—Ç —Ç–∞–∫–∏—Ö –∂–µ –æ–ø–µ—Ä–∞—Ü–∏–π –∫–∞–∫ –¥–ª—è –±–ª—é–¥

5. **–ó–∞–¥–∞—á–∏ –∏—Å—á–µ–∑–∞—é—Ç –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π**:
   - API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ä–æ–µ –ø–æ–ª–µ `status` –≤–º–µ—Å—Ç–æ `workflow_state`
   - –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ recognition –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ `status='in_progress'`
   - –ù–æ –ø–æ–∏—Å–∫ –∑–∞–¥–∞—á –∏–¥–µ—Ç –ø–æ `workflow_state='pending'`
   - –†–µ–∑—É–ª—å—Ç–∞—Ç: –∑–∞–¥–∞—á–∞ –∏—Å—á–µ–∑–∞–µ—Ç –∏–∑ –æ—á–µ—Ä–µ–¥–∏

## –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### üî¥ –ö–†–ò–¢–ò–ß–ù–û: –ò—Å–ø—Ä–∞–≤–∏—Ç—å workflow_state vs status

**–ü—Ä–æ–±–ª–µ–º–∞**: –ó–∞–¥–∞—á–∏ –∏—Å—á–µ–∑–∞—é—Ç –ø–æ—Å–ª–µ –ª—é–±–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π.

**–ö–æ—Ä–µ–Ω—å**: –í –±–∞–∑–µ –µ—Å—Ç—å –î–í–ê –ø–æ–ª—è (–∏–∑-–∑–∞ –º–∏–≥—Ä–∞—Ü–∏–π –≤ —Ä–∞–∑–Ω–æ–µ –≤—Ä–µ–º—è):
- `status` (—Å—Ç–∞—Ä–æ–µ, –º–∏–≥—Ä–∞—Ü–∏—è 20251104): 'not_started', 'in_progress', 'completed', 'rejected'
- `workflow_state` (–Ω–æ–≤–æ–µ, –º–∏–≥—Ä–∞—Ü–∏—è 20251106): 'pending', 'in_progress', 'completed', 'requires_correction'

**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è**:
- ‚úÖ –í—Å–µ endpoints –¥–ª—è **–ø–æ–∏—Å–∫–∞** –∑–∞–¥–∞—á –∏—Å–ø–æ–ª—å–∑—É—é—Ç `workflow_state` (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
- ‚ùå Endpoints –¥–ª—è **—Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è** –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π –æ–±–Ω–æ–≤–ª—è—é—Ç `status` (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ!)
- ‚ùå –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏: `status='in_progress'`, –Ω–æ `workflow_state='pending'`
- ‚ùå –ó–∞–¥–∞—á–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –≤ `workflow_state='pending'`, –Ω–æ —É–∂–µ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è (–∫–∞–∫–∞—è-—Ç–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç)

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –≤ –∫–æ–¥–µ**:
- `/api/annotations/tasks/next` (—Å—Ç—Ä–æ–∫–∞ 120): `.eq('workflow_state', 'pending')` ‚úÖ
- `/api/annotations/annotations/route.ts` (—Å—Ç—Ä–æ–∫–∞ 77): `status: 'in_progress'` ‚ùå
- `/api/annotations/annotations/[id]/route.ts` (—Å—Ç—Ä–æ–∫–∏ 96, 182): `status: 'in_progress'` ‚ùå

**–†–µ—à–µ–Ω–∏–µ**:

1. **–§–∞–π–ª**: `src/app/api/annotations/annotations/route.ts` (POST - —Å–æ–∑–¥–∞–Ω–∏–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏)
   - –°—Ç—Ä–æ–∫–∏ 66-87: –ó–∞–º–µ–Ω–∏—Ç—å `status` –Ω–∞ `workflow_state`
   ```typescript
   // –ë—ã–ª–æ:
   const { data: recognition } = await supabase
     .from('recognitions')
     .select('status')
     .eq('recognition_id', image.recognition_id)
     .single()

   if (recognition && recognition.status !== 'completed') {
     await supabase
       .from('recognitions')
       .update({ 
         status: 'in_progress',
         has_modifications: true
       })
   
   // –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
   const { data: recognition } = await supabase
     .from('recognitions')
     .select('workflow_state')
     .eq('recognition_id', image.recognition_id)
     .single()

   if (recognition && recognition.workflow_state !== 'completed') {
     await supabase
       .from('recognitions')
       .update({ 
         workflow_state: 'in_progress',
         has_modifications: true
       })
   ```

2. **–§–∞–π–ª**: `src/app/api/annotations/annotations/[id]/route.ts` (PUT –∏ DELETE)
   - –°—Ç—Ä–æ–∫–∏ 85-110 (PUT): –ó–∞–º–µ–Ω–∏—Ç—å `status` –Ω–∞ `workflow_state`
   - –°—Ç—Ä–æ–∫–∏ 171-196 (DELETE): –ó–∞–º–µ–Ω–∏—Ç—å `status` –Ω–∞ `workflow_state`
   - –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –ø—É–Ω–∫—Ç—É

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:
- –û—Ç–∫—Ä—ã—Ç—å –∑–∞–¥–∞—á—É –≤ quick mode
- –ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å bbox –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
- –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
- ‚úÖ –ó–∞–¥–∞—á–∞ –¥–æ–ª–∂–Ω–∞ –æ—Å—Ç–∞—Ç—å—Å—è –≤ —Å–ø–∏—Å–∫–µ (–Ω–µ –∏—Å—á–µ–∑–Ω—É—Ç—å)

---

### üìã –£—á–µ—Å—Ç—å —Ç–∞—Ä–µ–ª–∫–∏ –≤ validation_mode

**–ü—Ä–æ–±–ª–µ–º–∞**: Quick mode –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ –±–ª—é–¥–∞–º, —Ç–∞—Ä–µ–ª–∫–∏ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è.

**–†–µ—à–µ–Ω–∏–µ**:

1. **–§–∞–π–ª**: `supabase/migrations/YYYYMMDDHHMMSS_update_validation_mode_with_plates.sql`
   ```sql
   -- –û–±–Ω–æ–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é calculate_validation_mode
   CREATE OR REPLACE FUNCTION calculate_validation_mode(recognition_id_param TEXT)
   RETURNS TEXT AS $$
   DECLARE
     main_dishes_count INT;
     qual_dishes_count INT;
     main_plates_count INT;
     qual_plates_count INT;
     expected_count INT;
     dish_record RECORD;
   BEGIN
     -- –ü–æ–ª—É—á–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
     -- ... (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –¥–ª—è –±–ª—é–¥)
     
     -- –î–û–ë–ê–í–ò–¢–¨: –ü–æ–¥—Å—á–µ—Ç —Ç–∞—Ä–µ–ª–æ–∫
     SELECT COUNT(*) INTO main_plates_count
     FROM annotations a
     JOIN recognition_images ri ON a.image_id = ri.id
     WHERE ri.recognition_id = recognition_id_param
       AND ri.photo_type = 'Main'
       AND a.object_type = 'plate';
     
     SELECT COUNT(*) INTO qual_plates_count
     FROM annotations a
     JOIN recognition_images ri ON a.image_id = ri.id
     WHERE ri.recognition_id = recognition_id_param
       AND ri.photo_type = 'Qualifying'
       AND a.object_type = 'plate';
     
     -- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞—Ä–µ–ª–æ–∫ (–≤–∫–ª—é—á–∞—è 0:0 –∫–∞–∫ –≤–∞–ª–∏–¥–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ)
     IF main_plates_count != qual_plates_count THEN
       RETURN 'edit';
     END IF;
     
     -- ... (–æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –±–ª—é–¥)
   END;
   $$ LANGUAGE plpgsql;
   ```

2. **–§–∞–π–ª**: `src/hooks/useDishValidation.ts`
   - –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Å—á–µ—Ç —Ç–∞—Ä–µ–ª–æ–∫ –≤ `isAligned`:
   ```typescript
   const mainPlatesCount = mainImage?.annotations.filter(a => a.object_type === 'plate').length || 0
   const qualPlatesCount = qualImage?.annotations.filter(a => a.object_type === 'plate').length || 0
   const platesAligned = mainPlatesCount === qualPlatesCount
   
   const isAligned = dishesAligned && platesAligned
   ```

3. **–§–∞–π–ª**: `src/components/tasks/DishList.tsx`
   - –î–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ü–∏—é "–¢–ê–†–ï–õ–ö–ò" –ø–µ—Ä–µ–¥ "–ë–õ–Æ–î–ê –ò–ó –ß–ï–ö–ê"
   - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å badge `M:X Q:Y` –¥–ª—è —Ç–∞—Ä–µ–ª–æ–∫
   - –¶–≤–µ—Ç: –∑–µ–ª–µ–Ω—ã–π –µ—Å–ª–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç (–≤–∫–ª—é—á–∞—è 0:0), –∫—Ä–∞—Å–Ω—ã–π –µ—Å–ª–∏ –Ω–µ—Ç

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:
- –ó–∞–¥–∞—á–∞ —Å —Ç–∞—Ä–µ–ª–∫–∞–º–∏ M:1 Q:0 ‚Üí –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ edit mode (–∫—Ä–∞—Å–Ω—ã–π badge)
- –ó–∞–¥–∞—á–∞ —Å —Ç–∞—Ä–µ–ª–∫–∞–º–∏ M:0 Q:0 ‚Üí –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ quick mode (–µ—Å–ª–∏ –±–ª—é–¥–∞ —Å–æ–≤–ø–∞–¥–∞—é—Ç)
- –ó–∞–¥–∞—á–∞ —Å —Ç–∞—Ä–µ–ª–∫–∞–º–∏ M:2 Q:2 ‚Üí –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ quick mode (–µ—Å–ª–∏ –±–ª—é–¥–∞ —Å–æ–≤–ø–∞–¥–∞—é—Ç)

---

### üé® –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å `/annotations/[id]` - —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è —Å edit mode

**–ü—Ä–æ–±–ª–µ–º–∞**: –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å `/annotations/[id]` —É—Å—Ç–∞—Ä–µ–≤—à–∏–π, –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç edit mode.

**–¶–µ–ª—å**: –°–¥–µ–ª–∞—Ç—å `/annotations/[id]` –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–º `dish_validation` edit mode.

**–†–µ—à–µ–Ω–∏–µ**:

1. **–£–¥–∞–ª–∏—Ç—å –∏–∑ `/annotations/[id]/page.tsx`**:
   - Reducer (`useReducer`, `AnnotationAction`, `annotationReducer`)
   - Undo/redo –ª–æ–≥–∏–∫–∞
   - –¢–∞–±—ã –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   - –°—Ç–∞—Ä—ã–π UI —Å –±–æ–ª—å—à–∏–º–∏ –ø–ª–∞—à–∫–∞–º–∏

2. **–î–æ–±–∞–≤–∏—Ç—å –≤ `/annotations/[id]/page.tsx`**:
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `useAnnotations` hook (–∫–∞–∫ –≤ `DishValidationClient.tsx`)
   - –î–≤–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (side-by-side)
   - `DishList` –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤ –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏
   - –¢–∞—Ä–µ–ª–∫–∏ –≤ –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏ —Å –ø–æ–ª–Ω—ã–º–∏ –∫–æ–Ω—Ç—Ä–æ–ª–∞–º–∏
   - Draggable popup —Å —Ç–∞–±–∞–º–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π (—á–µ–∫, –ø—Ä–µ–¥–º–µ—Ç—ã, —Ç–∞—Ä–µ–ª–∫–∏, –±–∞–∑–∑–µ—Ä)
   - Hotkeys: 1=—Ç–∞—Ä–µ–ª–∫–∏, 2-9=–±–ª—é–¥–∞, H=–ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ, D=—Ä–∏—Å–æ–≤–∞—Ç—å, Del=—É–¥–∞–ª–∏—Ç—å, Tab=–ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

3. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–æ–≤–æ–≥–æ `/annotations/[id]/page.tsx`**:
   ```typescript
   // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å: src/app/annotations/tasks/dish_validation/DishValidationClient.tsx
   
   export default function AnnotationPage({ params }) {
     const { images, createAnnotation, updateAnnotation, deleteAnnotation, setLocalImages } = useAnnotations([])
     
     // UI state
     const [activeImage, setActiveImage] = useState<'Main' | 'Qualifying'>('Main')
     const [drawingMode, setDrawingMode] = useState(false)
     const [showAllBBoxes, setShowAllBBoxes] = useState(true)
     const [highlightedDishIndex, setHighlightedDishIndex] = useState<number | null>(null)
     const [highlightedPlate, setHighlightedPlate] = useState(false)
     
     // Popup state –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π
     const [pendingBBox, setPendingBBox] = useState(...)
     const [activeTab, setActiveTab] = useState<'check' | 'nonfood' | 'plate' | 'buzzer'>('check')
     
     // Layout: Left panel (DishList) + Two images side-by-side
     return (
       <div className="flex">
         <div className="w-96">
           <DishList
             dishes={recognition.correct_dishes}
             images={images}
             onDishClick={handleDishClick}
             onPlateClick={handlePlateClick}
             showControls={true}
           />
         </div>
         <div className="flex-1 grid grid-cols-2 gap-4">
           <BBoxAnnotator imageUrl={mainImage} ... />
           <BBoxAnnotator imageUrl={qualifyingImage} ... />
         </div>
       </div>
     )
   }
   ```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:
- –û—Ç–∫—Ä—ã—Ç—å `/annotations/109734`
- ‚úÖ –î–≤–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- ‚úÖ –¢–∞—Ä–µ–ª–∫–∏ –≤ –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏
- ‚úÖ Hotkeys —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –ú–æ–∂–Ω–æ —Ä–∏—Å–æ–≤–∞—Ç—å bbox –Ω–∞ –∞–∫—Ç–∏–≤–Ω–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏
- ‚úÖ Draggable popup –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –æ–±—ä–µ–∫—Ç–∞

---

### üõ†Ô∏è –î–æ–±–∞–≤–∏—Ç—å —Ç—É–ª–±–æ–∫—Å—ã –Ω–∞–¥ bbox

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤ –Ω–∞–¥ –∫–∞–∂–¥—ã–º bbox –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.

**–†–µ—à–µ–Ω–∏–µ**:

1. **–§–∞–π–ª**: `src/components/BBoxAnnotator.tsx`
   - –î–æ–±–∞–≤–∏—Ç—å prop `showControls: boolean`
   - –ï—Å–ª–∏ `showControls={true}`, –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç—É–ª–±–æ–∫—Å –Ω–∞–¥ –∫–∞–∂–¥—ã–º bbox —Å –∫–Ω–æ–ø–∫–∞–º–∏:
     - üìè Resize (—É–∂–µ –µ—Å—Ç—å, –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑–∞—Ç—å)
     - üîÑ Overlapped (toggle `is_overlapped`)
     - üçæ Bottle up/down (toggle `is_bottle_up` –¥–ª—è –±—É—Ç—ã–ª–æ–∫)
     - ‚ö†Ô∏è Error (toggle `is_error`)
     - üóëÔ∏è Delete

2. **–§–∞–π–ª**: `src/app/annotations/[id]/page.tsx`
   ```typescript
   <BBoxAnnotator
     showControls={true}  // –í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤ –ø–æ–ª–Ω–æ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
     ...
   />
   ```

3. **–§–∞–π–ª**: `src/app/annotations/tasks/dish_validation/DishValidationClient.tsx`
   ```typescript
   <BBoxAnnotator
     showControls={displayMode === 'edit'}  // –¢–æ–ª—å–∫–æ –≤ edit mode
     ...
   />
   ```

4. **–î–ª—è —Ç–∞—Ä–µ–ª–æ–∫**: –¢–µ –∂–µ –∫–æ–Ω—Ç—Ä–æ–ª—ã, —á—Ç–æ –∏ –¥–ª—è –±–ª—é–¥ (–∫—Ä–æ–º–µ bottle orientation)

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:
- –û—Ç–∫—Ä—ã—Ç—å edit mode
- –ù–∞–≤–µ—Å—Ç–∏ –Ω–∞ bbox
- ‚úÖ –ü–æ—è–≤–ª—è–µ—Ç—Å—è —Ç—É–ª–±–æ–∫—Å —Å –∫–Ω–æ–ø–∫–∞–º–∏
- ‚úÖ –ö–ª–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É –º–µ–Ω—è–µ—Ç —Å–≤–æ–π—Å—Ç–≤–æ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏
- ‚úÖ –î–ª—è —Ç–∞—Ä–µ–ª–æ–∫ —Ç–æ–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

### üî¢ –£–ª—É—á—à–∏—Ç—å –Ω—É–º–µ—Ä–∞—Ü–∏—é –≤ DishList

**–ü—Ä–æ–±–ª–µ–º–∞**: –¢–µ–∫—É—â–∞—è –Ω—É–º–µ—Ä–∞—Ü–∏—è:
- –ï—Å–ª–∏ —Ç–∞—Ä–µ–ª–æ–∫ –Ω–µ—Ç: –±–ª—é–¥–∞ #1, #2, #3...
- –ï—Å–ª–∏ —Ç–∞—Ä–µ–ª–∫–∏ –µ—Å—Ç—å: —Ç–∞—Ä–µ–ª–∫–∏ #1, –±–ª—é–¥–∞ #2, #3, #4...

–≠—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –Ω–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å UX.

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ 1 (—Ç–µ–∫—É—â–µ–µ)**: –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å
- Pros: –õ–æ–≥–∏—á–Ω–æ - –≤–∏–¥–∏—à—å #2, –Ω–∞–∂–∏–º–∞–µ—à—å "2"
- Cons: –ü–µ—Ä–≤–æ–µ –±–ª—é–¥–æ –º–æ–∂–µ—Ç –±—ã—Ç—å #1 –∏–ª–∏ #2 –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∞—Ä–µ–ª–æ–∫

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ 2**: –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –Ω—É–º–µ—Ä–∞—Ü–∏—è
- –¢–∞—Ä–µ–ª–∫–∏ –≤—Å–µ–≥–¥–∞ #1 (–∫–ª–∞–≤–∏—à–∞ "1")
- –ë–ª—é–¥–∞ –≤—Å–µ–≥–¥–∞ #2-9 (–∫–ª–∞–≤–∏—à–∏ "2-9")
- –ï—Å–ª–∏ —Ç–∞—Ä–µ–ª–æ–∫ –Ω–µ—Ç, –∫–ª–∞–≤–∏—à–∞ "1" –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- Pros: –í—Å–µ–≥–¥–∞ –æ–¥–∏–Ω–∞–∫–æ–≤–æ
- Cons: –í–∏–¥–∏—à—å #2, –Ω–æ —ç—Ç–æ –ø–µ—Ä–≤–æ–µ –±–ª—é–¥–æ (–º–æ–∂–µ—Ç —Å–±–∏–≤–∞—Ç—å)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –û—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–∫—É—â—É—é –ª–æ–≥–∏–∫—É (–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ 1), –æ–Ω–∞ –±–æ–ª–µ–µ –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–∞—è.

**–§–∞–π–ª**: `src/components/tasks/DishList.tsx`
```typescript
// –¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞ (–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è):
<span className="text-xs font-mono text-gray-500">
  #{hasPlates ? index + 2 : index + 1}
</span>
```

---

### üîÑ –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É bbox –æ–¥–Ω–æ–≥–æ –±–ª—é–¥–∞

**–ü—Ä–æ–±–ª–µ–º–∞**: –ï—Å–ª–∏ –≤ —á–µ–∫–µ 1 –±–ª—é–¥–æ, –Ω–æ bbox 2 (–æ—à–∏–±–∫–∞ —Ä–∞–∑–º–µ—Ç–∫–∏), –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É –Ω–∏–º–∏.

**–†–µ—à–µ–Ω–∏–µ**:

1. **–§–∞–π–ª**: `src/app/annotations/tasks/dish_validation/DishValidationClient.tsx`
   - –í `handleDishClick`: –µ—Å–ª–∏ –∫–ª–∏–∫–Ω—É–ª–∏ –Ω–∞ —É–∂–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –±–ª—é–¥–æ, —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É –µ–≥–æ bbox
   ```typescript
   const handleDishClick = (dishIndex: number) => {
     if (highlightedDishIndex === dishIndex) {
       // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É bbox —ç—Ç–æ–≥–æ –±–ª—é–¥–∞
       const allBboxes = [
         ...mainImage.annotations.filter(a => a.dish_index === dishIndex),
         ...qualImage.annotations.filter(a => a.dish_index === dishIndex)
       ]
       if (allBboxes.length > 1) {
         const nextIndex = (selectedBBoxIndexInDish + 1) % allBboxes.length
         setSelectedBBoxIndexInDish(nextIndex)
         setSelectedAnnotation(allBboxes[nextIndex])
       }
     } else {
       // –ü–µ—Ä–≤—ã–π –≤—ã–±–æ—Ä –±–ª—é–¥–∞
       setHighlightedDishIndex(dishIndex)
       setSelectedBBoxIndexInDish(0)
       // ...
     }
   }
   ```

2. **Hotkey**: –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –Ω–∞–∂–∞—Ç–∏–µ –∫–ª–∞–≤–∏—à–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "2" –ø–æ—Ç–æ–º –µ—â–µ —Ä–∞–∑ "2") —Ç–æ–∂–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:
- –ë–ª—é–¥–æ #2 –∏–º–µ–µ—Ç 2 bbox (M:1, Q:1, –Ω–æ –≤ —á–µ–∫–µ Count=1)
- –ù–∞–∂–∞—Ç—å "2" ‚Üí –≤—ã–¥–µ–ª—è–µ—Ç—Å—è –ø–µ—Ä–≤—ã–π bbox
- –ù–∞–∂–∞—Ç—å "2" –µ—â–µ —Ä–∞–∑ ‚Üí –≤—ã–¥–µ–ª—è–µ—Ç—Å—è –≤—Ç–æ—Ä–æ–π bbox
- –ù–∞–∂–∞—Ç—å "2" –µ—â–µ —Ä–∞–∑ ‚Üí —Å–Ω–æ–≤–∞ –ø–µ—Ä–≤—ã–π bbox (—Ü–∏–∫–ª)

---

### üì¶ –í—ã–±–æ—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –±–ª—é–¥–∞

**–ü—Ä–æ–±–ª–µ–º–∞**: –ï—Å–ª–∏ –≤ —á–µ–∫–µ –¥–ª—è –æ–¥–Ω–æ–≥–æ item –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –±–ª—é–¥ (Dishes.length > 1), –Ω—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ.

**–†–µ—à–µ–Ω–∏–µ**:

1. **–ú–∏–≥—Ä–∞—Ü–∏—è**: `supabase/migrations/YYYYMMDDHHMMSS_add_dish_variant_selection.sql`
   ```sql
   ALTER TABLE annotations 
   ADD COLUMN selected_dish_variant_index INTEGER;
   
   COMMENT ON COLUMN annotations.selected_dish_variant_index IS 
   '–ò–Ω–¥–µ–∫—Å –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –±–ª—é–¥–∞ –∏–∑ Dishes –º–∞—Å—Å–∏–≤–∞ (–µ—Å–ª–∏ Dishes.length > 1)';
   ```

2. **–§–∞–π–ª**: `src/types/annotations.ts`
   ```typescript
   export interface Annotation {
     // ... existing fields
     selected_dish_variant_index?: number | null
   }
   ```

3. **–§–∞–π–ª**: `src/components/tasks/DishList.tsx`
   - –ï—Å–ª–∏ `Dishes.length > 1`, –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø–æ–¥ –±–ª—é–¥–æ–º
   - –ö–ª–∏–∫ –Ω–∞ –≤–∞—Ä–∏–∞–Ω—Ç ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç `onVariantSelect(dishIndex, variantIndex)`
   ```typescript
   {dish.Dishes.length > 1 && (
     <div className="mt-2 space-y-1">
       <p className="text-xs text-gray-500">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç:</p>
       {dish.Dishes.map((variant, varIdx) => (
         <button
           key={varIdx}
           onClick={() => onVariantSelect?.(dishIndex, varIdx)}
           className="w-full text-left text-xs hover:bg-blue-50 px-2 py-1"
         >
           ‚Ä¢ {variant.Name || variant.product_name}
         </button>
       ))}
     </div>
   )}
   ```

4. **–§–∞–π–ª**: `src/app/annotations/tasks/dish_validation/DishValidationClient.tsx`
   ```typescript
   const handleVariantSelect = async (dishIndex: number, variantIndex: number) => {
     // –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ bbox —ç—Ç–æ–≥–æ –±–ª—é–¥–∞
     const allBboxes = [
       ...mainImage.annotations.filter(a => a.dish_index === dishIndex),
       ...qualImage.annotations.filter(a => a.dish_index === dishIndex)
     ]
     
     for (const bbox of allBboxes) {
       await updateAnnotation(bbox.id, { selected_dish_variant_index: variantIndex })
     }
   }
   
   // –ü–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º –∑–∞–¥–∞—á–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –≤—ã–±—Ä–∞–Ω—ã
   const handleComplete = async () => {
     const unselectedDishes = taskData.recognition.correct_dishes
       .filter((dish, idx) => {
         if (dish.Dishes.length <= 1) return false
         const bboxes = images.flatMap(img => 
           img.annotations.filter(a => a.dish_index === idx)
         )
         return bboxes.some(b => b.selected_dish_variant_index == null)
       })
     
     if (unselectedDishes.length > 0) {
       alert('–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è –±–ª—é–¥ —Å –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç—å—é')
       return
     }
     
     await completeTask()
   }
   ```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:
- –ë–ª—é–¥–æ #2: Count=1, Dishes=[{Name: "FUZE TEA"}, {Name: "FUZE TEA LEMON"}]
- –í –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏ –ø–æ–¥ –±–ª—é–¥–æ–º #2 –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
- –ö–ª–∏–∫ –Ω–∞ "FUZE TEA" ‚Üí –≤—Å–µ bbox —ç—Ç–æ–≥–æ –±–ª—é–¥–∞ –ø–æ–º–µ—á–∞—é—Ç—Å—è `selected_dish_variant_index=0`
- –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–¥–∞—á—É –±–µ–∑ –≤—ã–±–æ—Ä–∞ ‚Üí –æ—à–∏–±–∫–∞
- –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ ‚Üí –∑–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ

---

## –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

1. **üî¥ –ö–†–ò–¢–ò–ß–ù–û**: –ò—Å–ø—Ä–∞–≤–∏—Ç—å workflow_state vs status (–±–µ–∑ —ç—Ç–æ–≥–æ —Å–∏—Å—Ç–µ–º–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
2. –£—á–µ—Å—Ç—å —Ç–∞—Ä–µ–ª–∫–∏ –≤ validation_mode
3. –î–æ–±–∞–≤–∏—Ç—å —Ç—É–ª–±–æ–∫—Å—ã –Ω–∞–¥ bbox
4. –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å `/annotations/[id]`
5. –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É bbox
6. –í—ã–±–æ—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –±–ª—é–¥–∞

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### ‚ö†Ô∏è –ù–ò–ö–û–ì–î–ê –Ω–µ –¥–µ–ª–∞—Ç—å db reset
```bash
# ‚ùå –ó–ê–ü–†–ï–©–ï–ù–û
supabase db reset

# ‚úÖ –¢–û–õ–¨–ö–û migration up
supabase migration up
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è

–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –ø—É–Ω–∫—Ç–∞:
1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å dev server: `npm run dev`
2. –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à: `rm -rf .next`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ
4. –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ - –æ—Ç–∫–∞—Ç–∏—Ç—å –∫–æ–º–º–∏—Ç –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å

### –†–µ—Ñ–µ—Ä–µ–Ω—Å–Ω—ã–µ —Ñ–∞–π–ª—ã

- **–•–æ—Ä–æ—à–∏–π –ø—Ä–∏–º–µ—Ä edit mode**: `src/app/annotations/tasks/dish_validation/DishValidationClient.tsx`
- **–•–æ—Ä–æ—à–∏–π –ø—Ä–∏–º–µ—Ä DishList**: `src/components/tasks/DishList.tsx`
- **–•–æ—Ä–æ—à–∏–π –ø—Ä–∏–º–µ—Ä BBoxAnnotator**: `src/components/BBoxAnnotator.tsx`

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```sql
-- –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
recognitions (
  recognition_id TEXT PRIMARY KEY,
  workflow_state TEXT,  -- 'pending', 'in_progress', 'completed'
  status TEXT,          -- –£–°–¢–ê–†–ï–õ–û, –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
  validation_mode TEXT, -- 'quick', 'edit'
  correct_dishes JSONB,
  task_queue TEXT,      -- 'dish_validation', 'check_error', etc
  assigned_to TEXT,
  has_modifications BOOLEAN
)

recognition_images (
  id SERIAL PRIMARY KEY,
  recognition_id TEXT REFERENCES recognitions,
  photo_type TEXT,      -- 'Main', 'Qualifying'
  storage_path TEXT,
  original_annotations JSONB  -- –î–ª—è –æ—Ç–∫–∞—Ç–∞ –∫ QWEN
)

annotations (
  id SERIAL PRIMARY KEY,
  image_id INTEGER REFERENCES recognition_images,
  object_type TEXT,     -- 'food', 'plate', 'buzzer', 'non_food'
  object_subtype TEXT,
  dish_index INTEGER,   -- –ò–Ω–¥–µ–∫—Å –≤ correct_dishes –º–∞—Å—Å–∏–≤–µ
  bbox_x1, bbox_y1, bbox_x2, bbox_y2 INTEGER,
  is_overlapped BOOLEAN,
  is_bottle_up BOOLEAN,
  is_error BOOLEAN,
  source TEXT,          -- 'qwen_auto', 'manual'
  selected_dish_variant_index INTEGER  -- –ù–æ–≤–æ–µ –ø–æ–ª–µ
)
```

## –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

1. ‚úÖ –ó–∞–¥–∞—á–∏ –Ω–µ –∏—Å—á–µ–∑–∞—é—Ç –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
2. ‚úÖ –¢–∞—Ä–µ–ª–∫–∏ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤ quick/edit mode
3. ‚úÖ `/annotations/[id]` –∏–¥–µ–Ω—Ç–∏—á–µ–Ω edit mode
4. ‚úÖ –¢—É–ª–±–æ–∫—Å—ã –Ω–∞–¥ –∫–∞–∂–¥—ã–º bbox
5. ‚úÖ –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É bbox –æ–¥–Ω–æ–≥–æ –±–ª—é–¥–∞
6. ‚úÖ –ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –ø—Ä–∏ –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç–∏
7. ‚úÖ –ï–¥–∏–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –±–ª—é–¥ –∏ —Ç–∞—Ä–µ–ª–æ–∫
8. ‚úÖ –ò–Ω—Ç—É–∏—Ç–∏–≤–Ω–∞—è –Ω—É–º–µ—Ä–∞—Ü–∏—è

---

**–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–±–æ—á–∏–π –∫–æ–º–º–∏—Ç**: `aabca52` (fix: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—ã–∑–æ–≤—ã finishAnnotationCreate –¥–ª—è plates –∏ dishes)

**–í–µ—Ç–∫–∞**: `feature/annotation-workflow`

**–î–∞—Ç–∞**: 2025-11-11

